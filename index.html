<!DOCTYPE html>
<html dir="rtl">
<head>
    <meta charset="UTF-8">
    <title>ğŸ’¬ Ø´Ø§Øª Ù…Ø¬ØªÙ…Ø¹Ù†Ø§ | 9 Ø£Ø´Ø®Ø§Øµ</title>
    <style>
        body { 
            font-family: Arial, sans-serif; 
            background: #0f172a; 
            color: white; 
            padding: 20px; 
            margin: 0; 
        }
        
        .container { 
            max-width: 800px; 
            margin: 0 auto; 
        }
        
        .header { 
            text-align: center; 
            padding: 20px; 
            background: #1e293b; 
            border-radius: 10px; 
            margin-bottom: 20px; 
        }
        
        .chat-box { 
            height: 500px; 
            border: 2px solid #334155; 
            background: #1e293b; 
            border-radius: 10px; 
            padding: 15px; 
            overflow-y: auto; 
            margin-bottom: 15px; 
        }
        
        .message { 
            padding: 10px 15px; 
            margin: 10px 0; 
            border-radius: 10px; 
            max-width: 80%; 
            clear: both; 
        }
        
        .my-message { 
            background: #3b82f6; 
            float: right; 
            text-align: left; 
        }
        
        .other-message { 
            background: #475569; 
            float: left; 
            text-align: right; 
        }
        
        .sender { 
            font-weight: bold; 
            font-size: 14px; 
            margin-bottom: 5px; 
        }
        
        .time { 
            font-size: 11px; 
            opacity: 0.7; 
            margin-top: 5px; 
        }
        
        .input-area { 
            display: flex; 
            gap: 10px; 
        }
        
        #messageInput { 
            flex: 1; 
            padding: 12px; 
            border: 2px solid #475569; 
            background: #1e293b; 
            color: white; 
            border-radius: 8px; 
            font-size: 16px; 
        }
        
        #sendBtn { 
            padding: 12px 25px; 
            background: #10b981; 
            color: white; 
            border: none; 
            border-radius: 8px; 
            cursor: pointer; 
            font-weight: bold; 
            font-size: 16px; 
        }
        
        #sendBtn:hover { 
            background: #059669; 
        }
        
        .status { 
            color: #10b981; 
            margin: 10px 0; 
            font-size: 14px; 
        }
        
        .system-msg { 
            text-align: center; 
            color: #94a3b8; 
            font-style: italic; 
            margin: 10px 0; 
            padding: 10px; 
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ğŸ’¬ Ø´Ø§Øª Ù…Ø¬ØªÙ…Ø¹Ù†Ø§ Ø§Ù„Ø®Ø§Øµ</h1>
            <p>Ø®Ø§Øµ Ù„Ù€ 9 Ø£Ø´Ø®Ø§Øµ ÙÙ‚Ø· â€¢ Ø´Ø§Øª Ù…Ø¨Ø§Ø´Ø± Ø§ÙˆÙ†Ù„Ø§ÙŠÙ†</p>
            <div class="status" id="status">Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø§ØªØµØ§Ù„...</div>
        </div>
        
        <div class="chat-box" id="chatBox">
            <!-- Ø§Ù„Ø±Ø³Ø§Ø¦Ù„ ØªØ¸Ù‡Ø± Ù‡Ù†Ø§ ØªÙ„Ù‚Ø§Ø¦ÙŠØ§ -->
            <div class="system-msg" id="loadingMsg">
                â³ Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø±Ø³Ø§Ø¦Ù„...
            </div>
        </div>
        
        <div class="input-area">
            <input type="text" id="messageInput" placeholder="Ø§ÙƒØªØ¨ Ø±Ø³Ø§Ù„ØªÙƒ Ù‡Ù†Ø§..." autocomplete="off">
            <button id="sendBtn">Ø¥Ø±Ø³Ø§Ù„ ğŸš€</button>
        </div>
    </div>

    <script>
        // ============ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª ============
        const GITHUB_TOKEN = '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';
        const REPO_OWNER = '3av4';
        const REPO_NAME = 'chatGreatness';
        const FILE_PATH = 'chat-data.json';
        
        // Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø§Ù„Ø¹Ø´ÙˆØ§Ø¦ÙŠ
        const arabicNames = ['ÙŠÙØ²ÙÙ†', 'Ø£Ø­Ù…Ø¯', 'Ù…Ø­Ù…Ø¯', 'Ø®Ø§Ù„Ø¯', 'Ø³Ø§Ù„Ù…', 'Ø¹Ù…Ø±', 'Ø¹Ù„ÙŠ', 'ÙØ§Ø±Ø³', 'Ù†Ø§ÙŠÙ'];
        const userName = arabicNames[Math.floor(Math.random() * arabicNames.length)] + Math.floor(Math.random() * 100);
        
        let chatData = {
            messages: [],
            users: [],
            settings: { maxUsers: 9 }
        };
        
        let isInitialized = false;

        // ============ Ø¯Ø§Ù„Ø© Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ù€ GitHub ============
        async function githubAPI(endpoint, method = 'GET', data = null) {
            try {
                const options = {
                    method: method,
                    headers: {
                        'Authorization': `token ${GITHUB_TOKEN}`,
                        'Accept': 'application/vnd.github.v3+json',
                        'Content-Type': 'application/json'
                    }
                };
                
                if (data) {
                    options.body = JSON.stringify(data);
                }
                
                const response = await fetch(`https://api.github.com${endpoint}`, options);
                return await response.json();
            } catch (error) {
                console.error('GitHub API Error:', error);
                throw error;
            }
        }

        // ============ ØªÙ‡ÙŠØ¦Ø© Ø§Ù„Ù†Ø¸Ø§Ù… ============
        async function initializeSystem() {
            try {
                document.getElementById('status').textContent = 'Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ø¶ÙŠØ±...';
                
                // 1. Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† ÙˆØ¬ÙˆØ¯ Ø§Ù„Ù…Ø³ØªÙˆØ¯Ø¹
                try {
                    await githubAPI(`/repos/${REPO_OWNER}/${REPO_NAME}`);
                } catch (error) {
                    // 2. Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ù…Ø³ØªÙˆØ¯Ø¹ Ø¥Ø°Ø§ Ù„Ù… ÙŠÙƒÙ† Ù…ÙˆØ¬ÙˆØ¯Ø§Ù‹
                    await githubAPI('/user/repos', 'POST', {
                        name: REPO_NAME,
                        description: 'Ø´Ø§Øª Ù…Ø¬ØªÙ…Ø¹Ù†Ø§ Ø§Ù„Ø®Ø§Øµ - 9 Ø£Ø´Ø®Ø§Øµ',
                        private: false
                    });
                    
                    // 3. Ø¥Ù†Ø´Ø§Ø¡ Ù…Ù„Ù Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø£ÙˆÙ„ÙŠ
                    const initialData = {
                        messages: [{
                            id: Date.now(),
                            text: 'ğŸŒŸ Ø£Ù‡Ù„Ø§Ù‹ Ø¨Ø§Ù„Ø¬Ù…ÙŠØ¹ ÙÙŠ Ø´Ø§Øª Ù…Ø¬ØªÙ…Ø¹Ù†Ø§!',
                            sender: 'ğŸ‘‘ Ø§Ù„Ù†Ø¸Ø§Ù…',
                            time: new Date().toLocaleTimeString('ar-SA'),
                            date: new Date().toISOString()
                        }],
                        users: [userName],
                        settings: { maxUsers: 9, createdAt: new Date().toISOString() }
                    };
                    
                    await saveChatData(initialData);
                    chatData = initialData;
                }
                
                // 4. ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø­Ø§Ù„ÙŠØ©
                await loadChatData();
                
                // 5. ØªØ­Ø¯ÙŠØ« Ø­Ø§Ù„Ø© Ø§Ù„Ù†Ø¸Ø§Ù…
                document.getElementById('status').textContent = `ğŸŸ¢ Ø§ÙˆÙ†Ù„Ø§ÙŠÙ† Ø§Ù„Ø¢Ù† (${userName})`;
                document.getElementById('loadingMsg').remove();
                
                // 6. Ø¹Ø±Ø¶ Ø§Ù„Ø±Ø³Ø§Ø¦Ù„ Ø§Ù„Ù‚Ø¯ÙŠÙ…Ø©
                displayAllMessages();
                
                isInitialized = true;
                startAutoRefresh();
                
            } catch (error) {
                document.getElementById('status').textContent = 'âš ï¸ ÙˆØ¶Ø¹ Ø¹Ø¯Ù… Ø§Ù„Ø§ØªØµØ§Ù„';
                document.getElementById('loadingMsg').textContent = 'âš ï¸ Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø¹Ù…Ù„ Ø¨Ø§Ù„ÙˆØ¶Ø¹ Ø§Ù„Ù…Ø­Ù„ÙŠ...';
                useLocalMode();
            }
        }

        // ============ Ø­ÙØ¸ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ============
        async function saveChatData(data) {
            try {
                // Ø¬Ù„Ø¨ Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ù…Ù„Ù Ø§Ù„Ø­Ø§Ù„ÙŠ
                let sha = null;
                try {
                    const fileInfo = await githubAPI(`/repos/${REPO_OWNER}/${REPO_NAME}/contents/${FILE_PATH}`);
                    sha = fileInfo.sha;
                } catch (e) {
                    // Ø§Ù„Ù…Ù„Ù ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯
                }
                
                // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù…Ù„Ù
                await githubAPI(`/repos/${REPO_OWNER}/${REPO_NAME}/contents/${FILE_PATH}`, 'PUT', {
                    message: `ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø´Ø§Øª - ${userName} - ${new Date().toLocaleTimeString('ar-SA')}`,
                    content: btoa(JSON.stringify(data, null, 2)),
                    sha: sha
                });
                
                return true;
            } catch (error) {
                console.error('ÙØ´Ù„ Ø§Ù„Ø­ÙØ¸:', error);
                return false;
            }
        }

        // ============ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ============
        async function loadChatData() {
            try {
                const response = await githubAPI(`/repos/${REPO_OWNER}/${REPO_NAME}/contents/${FILE_PATH}`);
                const content = atob(response.content);
                chatData = JSON.parse(content);
                
                // Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø§Ù„Ø­Ø§Ù„ÙŠ Ø¥Ø°Ø§ Ù„Ù… ÙŠÙƒÙ† Ù…ÙˆØ¬ÙˆØ¯Ø§Ù‹
                if (!chatData.users.includes(userName)) {
                    chatData.users.push(userName);
                    await saveChatData(chatData);
                }
                
                return true;
            } catch (error) {
                console.error('ÙØ´Ù„ Ø§Ù„ØªØ­Ù…ÙŠÙ„:', error);
                return false;
            }
        }

        // ============ Ø¥Ø±Ø³Ø§Ù„ Ø±Ø³Ø§Ù„Ø© ============
        async function sendMessage() {
            const input = document.getElementById('messageInput');
            const text = input.value.trim();
            
            if (!text) return;
            
            // Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø±Ø³Ø§Ù„Ø©
            const newMessage = {
                id: Date.now(),
                text: text,
                sender: userName,
                time: new Date().toLocaleTimeString('ar-SA'),
                date: new Date().toISOString()
            };
            
            // Ø¥Ø¶Ø§ÙØ© Ù…Ø­Ù„ÙŠØ§Ù‹
            chatData.messages.push(newMessage);
            
            // Ø¹Ø±Ø¶ ÙÙˆØ±ÙŠ
            displayMessage(newMessage, true);
            
            // Ù…Ø³Ø­ Ø§Ù„Ø­Ù‚Ù„
            input.value = '';
            input.focus();
            
            // Ø­ÙØ¸ Ø¹Ù„Ù‰ GitHub
            const saved = await saveChatData(chatData);
            
            // Ù…Ø­Ø§ÙƒØ§Ø© Ø±Ø¯ÙˆØ¯ ØªÙ„Ù‚Ø§Ø¦ÙŠØ©
            if (saved) {
                simulateAutoResponse(text);
            }
        }

        // ============ Ø¹Ø±Ø¶ Ø§Ù„Ø±Ø³Ø§Ø¦Ù„ ============
        function displayMessage(message, isMine = false) {
            const chatBox = document.getElementById('chatBox');
            
            const msgDiv = document.createElement('div');
            msgDiv.className = `message ${isMine ? 'my-message' : 'other-message'}`;
            msgDiv.innerHTML = `
                <div class="sender">${message.sender}</div>
                <div>${message.text}</div>
                <div class="time">${message.time}</div>
            `;
            
            chatBox.appendChild(msgDiv);
            chatBox.scrollTop = chatBox.scrollHeight;
        }

        function displayAllMessages() {
            const chatBox = document.getElementById('chatBox');
            chatBox.innerHTML = '';
            
            chatData.messages.forEach(msg => {
                const isMine = msg.sender === userName;
                displayMessage(msg, isMine);
            });
        }

        // ============ Ù…Ø­Ø§ÙƒØ§Ø© Ø±Ø¯ÙˆØ¯ ØªÙ„Ù‚Ø§Ø¦ÙŠØ© ============
        function simulateAutoResponse(userText) {
            setTimeout(async () => {
                const responses = [
                    "Ø£Ù‡Ù„Ø§Ù‹ ÙˆØ³Ù‡Ù„Ø§Ù‹!",
                    "ÙƒÙŠÙ Ø§Ù„Ø­Ø§Ù„ØŸ",
                    "Ù…ÙŠÙ† Ù…ÙˆØ¬ÙˆØ¯ ØºÙŠØ±Ù†Ø§ØŸ",
                    "ÙÙƒØ±Ø© Ø¬Ù…ÙŠÙ„Ø© ğŸ‘",
                    "Ù†ØªÙƒÙ„Ù… Ø£ÙƒØ«Ø±ØŸ",
                    "Ø´ÙƒØ±Ø§Ù‹ Ø¹Ù„Ù‰ Ø§Ù„Ù…Ø´Ø§Ø±ÙƒØ© ğŸš€",
                    "Ø£ØªÙÙ‚ Ù…Ø¹Ùƒ ğŸ’¯"
                ];
                
                const randomResponse = responses[Math.floor(Math.random() * responses.length)];
                const randomUsers = ['Ø£Ø­Ù…Ø¯', 'Ù…Ø­Ù…Ø¯', 'Ø®Ø§Ù„Ø¯'];
                const randomUser = randomUsers[Math.floor(Math.random() * randomUsers.length)];
                
                const autoMessage = {
                    id: Date.now(),
                    text: randomResponse,
                    sender: randomUser,
                    time: new Date().toLocaleTimeString('ar-SA'),
                    date: new Date().toISOString()
                };
                
                // Ø¥Ø¶Ø§ÙØ© Ù„Ù„Ø¨ÙŠØ§Ù†Ø§Øª
                chatData.messages.push(autoMessage);
                displayMessage(autoMessage, false);
                
                // Ø­ÙØ¸ Ø§Ù„ØªØ­Ø¯ÙŠØ«
                await saveChatData(chatData);
                
            }, Math.random() * 3000 + 1000);
        }

        // ============ Ø§Ù„ØªØ­Ø¯ÙŠØ« Ø§Ù„ØªÙ„Ù‚Ø§Ø¦ÙŠ ============
        async function refreshChat() {
            if (!isInitialized) return;
            
            try {
                const oldCount = chatData.messages.length;
                await loadChatData();
                
                // Ø¹Ø±Ø¶ Ø§Ù„Ø±Ø³Ø§Ø¦Ù„ Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø© ÙÙ‚Ø·
                if (chatData.messages.length > oldCount) {
                    const newMessages = chatData.messages.slice(oldCount);
                    newMessages.forEach(msg => {
                        if (msg.sender !== userName) {
                            displayMessage(msg, false);
                        }
                    });
                }
                
                // ØªØ­Ø¯ÙŠØ« Ø¹Ø¯Ø¯ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ†
                const onlineUsers = chatData.users.length;
                document.getElementById('status').textContent = 
                    `ğŸŸ¢ ${onlineUsers}/9 Ø§ÙˆÙ†Ù„Ø§ÙŠÙ† (${userName})`;
                    
            } catch (error) {
                // ØµØ§Ù…Øª ÙÙŠ Ø­Ø§Ù„Ø© Ø§Ù„Ø®Ø·Ø£
            }
        }

        function startAutoRefresh() {
            setInterval(refreshChat, 5000); // ØªØ­Ø¯ÙŠØ« ÙƒÙ„ 5 Ø«ÙˆØ§Ù†ÙŠ
        }

        // ============ Ø§Ù„ÙˆØ¶Ø¹ Ø§Ù„Ù…Ø­Ù„ÙŠ (Ø¥Ø°Ø§ ÙØ´Ù„ Ø§Ù„Ø§ØªØµØ§Ù„) ============
        function useLocalMode() {
            // Ø¨ÙŠØ§Ù†Ø§Øª Ø§ÙØªØ±Ø§Ø¶ÙŠØ©
            chatData = {
                messages: [
                    {
                        id: Date.now(),
                        text: 'ğŸŒŸ Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø¹Ù…Ù„ Ø¨Ø§Ù„ÙˆØ¶Ø¹ Ø§Ù„Ù…Ø­Ù„ÙŠ. Ø§Ù„Ø§ØªØµØ§Ù„ Ø³ÙŠØ¹ÙˆØ¯ Ù‚Ø±ÙŠØ¨Ø§Ù‹.',
                        sender: 'ğŸ‘‘ Ø§Ù„Ù†Ø¸Ø§Ù…',
                        time: new Date().toLocaleTimeString('ar-SA'),
                        date: new Date().toISOString()
                    }
                ],
                users: [userName],
                settings: { maxUsers: 9 }
            };
            
            displayAllMessages();
            isInitialized = true;
        }

        // ============ ØªÙ‡ÙŠØ¦Ø© Ø§Ù„Ø£Ø­Ø¯Ø§Ø« ============
        document.getElementById('sendBtn').addEventListener('click', sendMessage);
        
        document.getElementById('messageInput').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                sendMessage();
            }
        });

        // ============ Ø¨Ø¯Ø¡ Ø§Ù„ØªØ´ØºÙŠÙ„ ============
        document.addEventListener('DOMContentLoaded', initializeSystem);
    </script>
</body>
</html>